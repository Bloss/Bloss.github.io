(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{66:function(t,s,n){"use strict";n.r(s);var a=n(0),o=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h2",{attrs:{id:"说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#说明","aria-hidden":"true"}},[t._v("#")]),t._v(" 说明")]),n("p",[t._v("本篇文章基于 "),n("code",[t._v("React-Router@4.0")]),t._v(", 原理上都是一样的, 但是 "),n("code",[t._v("react-router")]),t._v(" 版本之间 "),n("code",[t._v("api")]),t._v(" 差距巨大, 特此说明")]),n("h2",{attrs:{id:"history"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#history","aria-hidden":"true"}},[t._v("#")]),t._v(" history")]),n("p",[n("code",[t._v("react-router")]),t._v(" 依赖一个第三方库 "),n("a",{attrs:{href:"https://github.com/ReactTraining/history",target:"_blank",rel:"noopener noreferrer"}},[t._v("history")]),t._v(", 这个库兼容了不同浏览器, 不同环境下对浏览器历史记录的管理, 拥有统一的 "),n("code",[t._v("api")]),t._v(",那我们就先看一下这个库\n")]),n("p",[t._v("它有三种模式:")]),n("ul",[n("li",[n("code",[t._v("hash mode")]),t._v(": 一些老版本浏览器, 通过 "),n("code",[t._v("hash")]),t._v(" 来实现路由, 对应 "),n("code",[t._v("createHashHistory")])]),n("li",[n("code",[t._v("browserHistory mode")]),t._v(": "),n("code",[t._v("html5")]),t._v(" 的 "),n("code",[t._v("history")]),t._v(", 对应 "),n("code",[t._v("createBrowserHistory")])]),n("li",[n("code",[t._v("memoryHistory mode")]),t._v(": 用于 "),n("code",[t._v("node")]),t._v(" 环境, 对应 "),n("code",[t._v("createMemoryHistory")])])]),n("p",[t._v("我们以 "),n("code",[t._v("browserHistory")]),t._v(" 为例, 看下代码")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("createBrowserHistory")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    length"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" globalHistory"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    action"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"POP"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    location"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" initialLocation"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    createHref"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    push"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// push location")]),t._v("\n    replace"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 替换 location")]),t._v("\n    go"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    goBack"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    goForward"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    block"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    listen "),n("span",{attrs:{class:"token comment"}},[t._v("// location发生改变时的 callback")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("p",[t._v("我们可以看到 "),n("code",[t._v("createBrowserHistory")]),t._v(" 提供了一些 "),n("code",[t._v("api")]),t._v(", 可以用来监听 "),n("code",[t._v("location")]),t._v(" 的变化, 执行 "),n("code",[t._v("location")]),t._v(" 的前进, 后退, 替换等操作")]),n("p",[n("code",[t._v("history")]),t._v(" 看到这里就够了, 下面看看 "),n("code",[t._v("React-Router")])]),n("h2",{attrs:{id:"react-router-4-0"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#react-router-4-0","aria-hidden":"true"}},[t._v("#")]),t._v(" react-router@4.0")]),n("p",[t._v("我们上面看过了 "),n("code",[t._v("history")]),t._v(" 的 "),n("code",[t._v("api")]),t._v(", 发现有几个钩子函数以及监听函数, 那么其实我们已经有一些思路了")]),n("p",[n("strong",[t._v("我们看代码, 下面的代码是我对源码加以注释过的, 地址在这 "),n("a",{attrs:{href:"https://github.com/Bloss/react-router-analysis",target:"_blank",rel:"noopener noreferrer"}},[t._v("react-router-analysis")])])]),n("p",[t._v("看代码 "),n("a",{attrs:{href:"https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Router.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("Router")])]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Router")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("React"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" propTypes "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// history mode ==> browserHistory, hashHistory, memoryHistory 三种模式")]),t._v("\n    history"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isRequired"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// <Route />")]),t._v("\n    children"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("node\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" contextTypes "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    router"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" childContextTypes "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    router"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isRequired\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("getChildContext")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      router"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token operator"}},[t._v("...")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        history"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("history"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        route"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{attrs:{class:"token comment"}},[t._v("// 此处乃是浏览器 url 更新的行为")]),t._v("\n          "),n("span",{attrs:{class:"token comment"}},[t._v("// history.location, 当点击 Link 或者 push 路由的时候, location 会变化, Route 就会更新")]),t._v("\n          location"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("history"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          match"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("match "),n("span",{attrs:{class:"token comment"}},[t._v("// parent, 根路由 /")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  state "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    match"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("computeMatch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("history"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pathname"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("computeMatch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pathname"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      path"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"/"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      url"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"/"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      params"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      isExact"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pathname "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"/"')]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("componentWillMount")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" children"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" history "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token function"}},[t._v("invariant")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      children "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" React"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Children"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("count")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("children"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("1")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{attrs:{class:"token string"}},[t._v('"A <Router> may have only one child element"')]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 注册 history 的监听函数, 回调执行 setState({ match }), 对应的 childContext 也会更新")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("unlisten "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" history"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("listen")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("setState")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        match"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("computeMatch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("history"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pathname"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("componentWillReceiveProps")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("warning")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("history "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("history"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{attrs:{class:"token string"}},[t._v('"You cannot change <Router history>"')]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("componentWillUnmount")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("unlisten")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("render")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" children "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" children "),n("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v(" React"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Children"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("only")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("children"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("p",[t._v("在上面的代码中, 我们看到组件中定义了 "),n("code",[t._v("getChildContext")]),t._v(", 是一个 "),n("code",[t._v("router")]),t._v(" 对象, 而在这个对象中, 我们注意到有 "),n("code",[t._v("location")]),t._v(" 这个对象, 它的值为 "),n("code",[t._v("this.props.history.location")]),t._v(", 这个值就是当我们执行 "),n("code",[t._v("push(path)")]),t._v(" 或者点击 "),n("code",[t._v("Link")]),t._v(" 的时候, 调用了 "),n("code",[t._v("history.pushState")]),t._v(" 之后, 组件对应的 "),n("code",[t._v("location")]),t._v(" 值, 那么 "),n("code",[t._v("react-router")]),t._v(" 是如何根据这个值去寻找对应的组件并更新的呢, 这里就要说到关键的部分: "),n("code",[t._v("Route")]),t._v(" 以及 "),n("code",[t._v("matchPath")]),t._v(" 这个函数了.")]),n("p",[t._v("我们先看看 "),n("a",{attrs:{href:"https://github.com/Bloss/react-router-analysis/blob/master/react-router/matchPath.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("matchPath")])]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pathToRegexp "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"path-to-regexp"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" patternCache "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cacheLimit "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("10000")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" cacheCount "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 缓存解析的 path")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token function-variable function"}},[t._v("compilePath")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pattern"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cacheKey "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token template-string"}},[n("span",{attrs:{class:"token string"}},[t._v("`")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("end"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("strict"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sensitive"),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{attrs:{class:"token string"}},[t._v("`")])]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cache "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" patternCache"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cacheKey"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("patternCache"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cacheKey"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cache"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("pattern"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cache"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("pattern"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" keys "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" re "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("pathToRegexp")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pattern"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" keys"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" compiledPattern "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" re"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" keys "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheCount "),n("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" cacheLimit"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    cache"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("pattern"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" compiledPattern"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    cacheCount"),n("span",{attrs:{class:"token operator"}},[t._v("++")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" compiledPattern"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 关键的匹配函数")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token function-variable function"}},[t._v("matchPath")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pathname"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" parent"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" options "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"string"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" options "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" path"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" options "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" path"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exact "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" strict "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sensitive "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" options"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" parent"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" re"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" keys "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("compilePath")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" end"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" exact"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" strict"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sensitive "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" match "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" re"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("exec")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pathname"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 不匹配")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("match"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("url"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("values"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" match"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" isExact "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" pathname "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" url"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exact "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("isExact"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// the path pattern used to match")]),t._v("\n    url"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"/"')]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" url "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('""')]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"/"')]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" url"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 经过 matchPath 匹配后的 url")]),t._v("\n    isExact"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 是否完全匹配")]),t._v("\n    params"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" keys"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("reduce")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("memo"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      memo"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" values"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("index"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" memo"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),n("p",[t._v("上面的代码就是 "),n("code",[t._v("react-router")]),t._v(" 的匹配函数了, 第一个是缓存函数, 我们先不管, 看下第二个函数, 我们发现, 它根据传入的参数, 计算出了 "),n("code",[t._v("match")]),t._v(" 这个值, 如果不匹配, 就 "),n("code",[t._v("return null")]),t._v(" , 匹配的话则返回一个记载了组件状态的对象, 这个函数是在哪被执行的呢? 那么接下来就看看 "),n("code",[t._v("Route")]),t._v(" 这个组件")]),n("p",[n("strong",[t._v("重点: 这个组件是 react-router 如何根据 url 渲染 react 组件的关键")])]),n("p",[n("strong",[n("a",{attrs:{href:"https://github.com/Bloss/react-router-analysis/blob/master/react-router/Route.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("Route")])])]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"react"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" PropTypes "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"prop-types"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" matchPath "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"./matchPath"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token function-variable function"}},[t._v("isEmptyChildren")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" children "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" React"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Children"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("count")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("children"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Route")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("React"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" propTypes "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    computedMatch"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// private, from <Switch>")]),t._v("\n    path"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("string"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 是否精确匹配, true: path === location.pathname => true")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// case: true:  /one /one/two ===> false")]),t._v("\n    exact"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bool"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 是否匹配 '/'")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("//  /one/ /one ===> false")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("//  /one/ /one/ ===> true")]),t._v("\n    strict"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bool"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    sensitive"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bool"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 匹配字母大小写")]),t._v("\n    component"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("func"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    render"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("func"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    children"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("oneOfType")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("func"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("node"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    location"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 获取 Router 的 childContext")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" contextTypes "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    router"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("shape")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      history"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isRequired"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      route"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isRequired"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      staticContext"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" childContextTypes "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    router"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PropTypes"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isRequired\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// react-context")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("getChildContext")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      router"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token operator"}},[t._v("...")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        route"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          location"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location "),n("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          match"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("match\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  state "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// this.context.router: Router 中设置的 childContext")]),t._v("\n    match"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("computeMatch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 计算匹配路由")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("computeMatch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" computedMatch"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" location"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" strict"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exact"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sensitive "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    router\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 用了 Switch, 用 Switch 去匹配路由, 其实 Switch 匹配也是根据 matchPath 来匹配的")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("computedMatch"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" computedMatch"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// <Switch> already computed the match for us")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// route: Router 中设置的 context")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" route "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" router"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// path: Route 自己的 path")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// route.location: react-router 路由变更时, 重新根据 history.location 对象匹配")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// path 和 route.location 匹配成功则说明该组件就是我们想要的组件")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pathname "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("location "),n("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" route"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pathname"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("matchPath")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pathname"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" path"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" strict"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exact"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sensitive "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" route"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("match"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 一些警告, 不用管")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("componentWillMount")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("componentWillReceiveProps")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextContext"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("setState")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// Route 属性变更时, 重新计算路由")]),t._v("\n      match"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("computeMatch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextContext"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("render")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" match "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" children"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" component"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" render "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" history"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" route"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" staticContext "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("router"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" location "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location "),n("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" route"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" props "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" match"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" location"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" history"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" staticContext "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 渲染 Route 的 component 属性")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// match 匹配成功, 则渲染组件, 否则不渲染")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 此处就说明了 react-router 的逻辑, 当 pathname 和 location.path 匹配成功时, 就去渲染对应的 component")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("component"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" match "),n("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v(" React"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("createElement")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("component"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" props"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// Route 的 render 属性, 实际上通过 route Object 配置路由的时候, 就是通过该属性渲染的 component")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 见 [renderRoutes](https://github.com/ReactTraining/react-router/blob/master/packages/react-router-config/modules/renderRoutes.js)")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("render"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" match "),n("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("render")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// props: withRoute 中的 routeComponentProps")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// case: withRouter")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" children "),n("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"function"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("children")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("children "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("!")]),n("span",{attrs:{class:"token function"}},[t._v("isEmptyChildren")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("children"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// router v4 中, route 只允许有一个子组件 ")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" React"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Children"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("only")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("children"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("p",[t._v("上面代码中, 我们看到它获取了 "),n("code",[t._v("childContent")]),t._v(" 的 "),n("code",[t._v("router")]),t._v(" 对象, 然后获取到它的 "),n("code",[t._v("location")]),t._v(" 值, 这个值我们还记得吗? 就是根据当前浏览器的 "),n("code",[t._v("url")]),t._v(" 计算得出的一个 "),n("code",[t._v("location")]),t._v(" 对象, 然后在 "),n("code",[t._v("componentWillReceiveProps")]),t._v(" 生命周期中, 去执行 "),n("code",[t._v("matchPath")]),t._v(" 函数, 传入 "),n("code",[t._v("location")]),t._v(" 值, 得到一个组件状态对象 "),n("code",[t._v("match")]),t._v(", 如果 "),n("code",[t._v("return null")]),t._v(" 则说明匹配失败, 在 "),n("code",[t._v("render")]),t._v(" 函数中我们看到, "),n("code",[t._v("match")]),t._v(" 如果为 "),n("code",[t._v("null")]),t._v(", 则该组件就不渲染, 否则就说明匹配成功, 渲染该组件.")]),n("p",[t._v("这里的哲学思想其实 "),n("code",[t._v("v4.0")]),t._v(" 和 "),n("code",[t._v("v3.0")]),t._v(" 有很大的不同, 在 "),n("code",[t._v("v3.0")]),t._v(" 中, 是根据 "),n("code",[t._v("location")]),t._v(" 去寻找到对应的 "),n("code",[t._v("React Compoennt")]),t._v(" , 然后渲染. 而 "),n("code",[t._v("v4.0")]),t._v(" 中, 一切皆组件, 每一个路由都是一个 "),n("code",[t._v("Route")]),t._v(", "),n("code",[t._v("Route")]),t._v(" 也是一个组件, 渲染不渲染完全根据它自己的匹配结果来决定, 也就是说将匹配逻辑放到了组件自身中. 如此一来, 路由规则完全动态了.")]),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[t._v("#")]),t._v(" 总结")]),n("p",[t._v("我们将上述的零碎的东西串联起来:")]),n("p",[t._v("点击 "),n("code",[t._v("Link")]),t._v(" 或者 "),n("code",[t._v("push(path)")]),t._v(" 时调用 "),n("code",[t._v("history.push")]),t._v(" 去改变浏览器的 "),n("code",[t._v("url")]),t._v(" 同时返回 "),n("code",[t._v("location")]),t._v(" 对象, 然后触发 "),n("code",[t._v("Router")]),t._v(" 中的设置的 "),n("code",[t._v("history.listen")]),t._v(" 监听函数回调, 回调将 "),n("code",[t._v("location")]),t._v(" 放到 "),n("code",[t._v("getChildContext")]),t._v(" 中, 然后每个路由组件 "),n("code",[t._v("Route")]),t._v(" 都会更新, 在 "),n("code",[t._v("componentWillReceiveProps")]),t._v(" 中执行匹配函数 "),n("code",[t._v("mathPath")]),t._v(", 匹配成功则渲染, 否则不渲染, 这样每次 "),n("code",[t._v("Router")]),t._v(" 都只会渲染一个 "),n("code",[t._v("Route")]),t._v(" 组件.")]),n("p",[t._v("小小吐槽一下: "),n("code",[t._v("v4.0")]),t._v(" 这样做, "),n("code",[t._v("Route")]),t._v(" 中不能再嵌套 "),n("code",[t._v("Route")]),t._v(", 版本升级 "),n("code",[t._v("api")]),t._v(" 变动太大.")])])}],!1,null,null,null);s.default=o.exports}}]);